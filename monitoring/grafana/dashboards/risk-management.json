{
  "dashboard": {
    "id": null,
    "uid": "rrr-risk-management",
    "title": "RRR Trading - Risk Management",
    "tags": ["rrr-trading", "risk", "portfolio"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "10s",
    "panels": [
      {
        "id": 1,
        "gridPos": {"h": 6, "w": 6, "x": 0, "y": 0},
        "type": "stat",
        "title": "Portfolio Value",
        "targets": [
          {
            "expr": "risk_portfolio_value_usd",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "value",
          "textMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2
          }
        }
      },
      {
        "id": 2,
        "gridPos": {"h": 6, "w": 6, "x": 6, "y": 0},
        "type": "stat",
        "title": "Daily PnL",
        "targets": [
          {
            "expr": "risk_daily_pnl",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "background",
          "textMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": -5000, "color": "dark-red"},
                {"value": -1000, "color": "red"},
                {"value": 0, "color": "yellow"},
                {"value": 1000, "color": "green"},
                {"value": 5000, "color": "dark-green"}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "gridPos": {"h": 6, "w": 6, "x": 12, "y": 0},
        "type": "stat",
        "title": "Value at Risk (VaR 95%)",
        "targets": [
          {
            "expr": "risk_current_var",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "background",
          "textMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 5000, "color": "yellow"},
                {"value": 10000, "color": "orange"},
                {"value": 20000, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "gridPos": {"h": 6, "w": 6, "x": 18, "y": 0},
        "type": "stat",
        "title": "Max Drawdown",
        "targets": [
          {
            "expr": "risk_max_drawdown_percent",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "background",
          "textMode": "value"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 5, "color": "yellow"},
                {"value": 10, "color": "orange"},
                {"value": 15, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "gridPos": {"h": 10, "w": 12, "x": 0, "y": 6},
        "type": "graph",
        "title": "Portfolio Value Over Time",
        "targets": [
          {
            "expr": "risk_portfolio_value_usd",
            "legendFormat": "Portfolio Value",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "currencyUSD", "label": "Value ($)"},
          {"format": "short"}
        ],
        "lines": true,
        "fill": 2,
        "linewidth": 2
      },
      {
        "id": 6,
        "gridPos": {"h": 10, "w": 12, "x": 12, "y": 6},
        "type": "graph",
        "title": "Position Sizes (Kelly Criterion)",
        "targets": [
          {
            "expr": "risk_position_size",
            "legendFormat": "{{symbol}} Actual",
            "refId": "A"
          },
          {
            "expr": "risk_kelly_suggested_size",
            "legendFormat": "{{symbol}} Kelly Suggested",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "currencyUSD", "label": "Position Size ($)"},
          {"format": "short"}
        ],
        "lines": true,
        "fill": 1,
        "linewidth": 2,
        "seriesOverrides": [
          {
            "alias": "/Kelly Suggested/",
            "dashes": true,
            "fill": 0
          }
        ]
      },
      {
        "id": 7,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "type": "graph",
        "title": "Stop-Loss Triggers",
        "targets": [
          {
            "expr": "rate(risk_stop_loss_triggered_total[10m])",
            "legendFormat": "{{symbol}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "ops", "label": "Triggers/sec"},
          {"format": "short"}
        ],
        "lines": true,
        "fill": 2,
        "linewidth": 2,
        "bars": false,
        "points": true
      },
      {
        "id": 8,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
        "type": "graph",
        "title": "Exposure by Asset",
        "targets": [
          {
            "expr": "risk_exposure_usd",
            "legendFormat": "{{symbol}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "currencyUSD", "label": "Exposure ($)"},
          {"format": "short"}
        ],
        "lines": true,
        "fill": 2,
        "linewidth": 2,
        "stack": true
      },
      {
        "id": 9,
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 24},
        "type": "piechart",
        "title": "Portfolio Allocation",
        "targets": [
          {
            "expr": "sum by(symbol) (risk_position_value_usd)",
            "legendFormat": "{{symbol}}",
            "refId": "A"
          }
        ],
        "options": {
          "pieType": "donut",
          "displayLabels": ["name", "percent"]
        }
      },
      {
        "id": 10,
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 24},
        "type": "gauge",
        "title": "Risk Utilization",
        "targets": [
          {
            "expr": "risk_current_var / risk_var_limit",
            "refId": "A"
          }
        ],
        "options": {
          "showThresholdLabels": true,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "min": 0,
            "max": 1,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 0.7, "color": "yellow"},
                {"value": 0.85, "color": "orange"},
                {"value": 0.95, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 11,
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 24},
        "type": "graph",
        "title": "Sharpe & Sortino Ratios",
        "targets": [
          {
            "expr": "risk_sharpe_ratio",
            "legendFormat": "Sharpe Ratio",
            "refId": "A"
          },
          {
            "expr": "risk_sortino_ratio",
            "legendFormat": "Sortino Ratio",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "short", "label": "Ratio"},
          {"format": "short"}
        ],
        "lines": true,
        "fill": 1,
        "linewidth": 2
      },
      {
        "id": 12,
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
        "type": "graph",
        "title": "Correlation Matrix (BTC, ETH, SOL)",
        "targets": [
          {
            "expr": "risk_asset_correlation{asset1=\"BTC\",asset2=\"ETH\"}",
            "legendFormat": "BTC-ETH",
            "refId": "A"
          },
          {
            "expr": "risk_asset_correlation{asset1=\"BTC\",asset2=\"SOL\"}",
            "legendFormat": "BTC-SOL",
            "refId": "B"
          },
          {
            "expr": "risk_asset_correlation{asset1=\"ETH\",asset2=\"SOL\"}",
            "legendFormat": "ETH-SOL",
            "refId": "C"
          }
        ],
        "yaxes": [
          {"format": "short", "label": "Correlation", "min": -1, "max": 1},
          {"format": "short"}
        ],
        "lines": true,
        "fill": 1,
        "linewidth": 2
      },
      {
        "id": 13,
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
        "type": "table",
        "title": "Position Risk Summary",
        "targets": [
          {
            "expr": "risk_position_summary",
            "format": "table",
            "instant": true,
            "refId": "A"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "includeByName": {
                "symbol": true,
                "position_value": true,
                "stop_loss": true,
                "risk_percent": true,
                "kelly_pct": true
              }
            }
          }
        ],
        "options": {
          "showHeader": true,
          "sortBy": [{"displayName": "risk_percent", "desc": true}]
        }
      }
    ],
    "time": {"from": "now-24h", "to": "now"},
    "timepicker": {
      "refresh_intervals": ["10s", "30s", "1m", "5m"]
    }
  }
}
